<html>

<head>
  <title>Test api fetch</title>
</head>

<body>



  Email on database to test test@test.com
  <input type="text" id="email" placeholder="example@gmail.com">
  <button id="test-email">Test email</button>
  <div id="test-email-container"></div>
  <br>
  <br>
  <br>









  <script type="module">
    //import all modules needed for a phone aut
    import { } from "https://www.gstatic.com/firebasejs/6.0.2/firebase.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
    import { getAuth, signInWithPhoneNumber, RecaptchaVerifier, signInWithCredential, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";


    const firebaseConfig = {
      apiKey: "AIzaSyDp_QjlZP6cah2JBQLIXKSbfKtOIUfZ4Tw",
      authDomain: "cronoescape-ioc.firebaseapp.com",
      databaseURL: "https://cronoescape-ioc-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "cronoescape-ioc",
      storageBucket: "cronoescape-ioc.appspot.com",
      messagingSenderId: "240259839325",
      appId: "1:240259839325:web:20ef18366fd73d2aa2a4b4",
      measurementId: "G-QQD81WK4CE"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const database = getDatabase(app);







    //EMAIL TEST
    document.getElementById("test-email").addEventListener("click", testEmail);
    function testEmail() {
      let email = document.getElementById("email").value;
      if (emailNotValid(email)) {
        document.getElementById("test-email-container").innerHTML = "El email no es valido";
        return;
      }

      document.getElementById("test-email-container").innerHTML = "El email existe en la db: " + emailExists(email);

    }


    //function to check if the email is valid
    function emailNotValid(email) {
      return !(email.includes("@") && email.includes("."))
    }

    //function to check if the email already exists in the database
    function emailExists(email) {

      //replace the dots and @ in the email with nothing
      email = email.replace(/\./g, '');
      email = email.replace(/\@/g, '');


      let url = `${firebaseConfig.databaseURL}/emails/${email}/.json`;
      return dataExists(url);
    }



    //function to make an http request to the URL and return the response
    function httpRequest(url) {
      var httpRequest = new XMLHttpRequest();
      httpRequest.open('GET', url, false);
      httpRequest.send();
      if (httpRequest.status === 200) {
        return httpRequest.responseText;
      } else {
        return null;
      }
    }

    //function to check if the data exists in the database
    function dataExists(url) {
      let data = httpRequest(url);
      if (data != "null") {
        return true;
      } else {
        return false;
      }
    }



  </script>

</body>

</html>