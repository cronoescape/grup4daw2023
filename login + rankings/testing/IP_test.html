<html>

<head>
  <title>Test api fetch</title>
</head>

<body>
  TEST IP.<br>

  TU IP ES: <input type="text" id="ip-container" placeholder="192.xxx.x.x">
  <button id="test-ip">Get IP</button>
  <button id="test-id">check IP</button>

  <div id="test-id-container"></div>
  <br>
  <br>
  <br>









  <script type="module">
    //import all modules needed for a phone aut
    import { } from "https://www.gstatic.com/firebasejs/6.0.2/firebase.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
    import { getAuth, signInWithPhoneNumber, RecaptchaVerifier, signInWithCredential, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDp_QjlZP6cah2JBQLIXKSbfKtOIUfZ4Tw",
      authDomain: "cronoescape-ioc.firebaseapp.com",
      databaseURL: "https://cronoescape-ioc-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "cronoescape-ioc",
      storageBucket: "cronoescape-ioc.appspot.com",
      messagingSenderId: "240259839325",
      appId: "1:240259839325:web:20ef18366fd73d2aa2a4b4",
      measurementId: "G-QQD81WK4CE"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const database = getDatabase(app);


    //IP methods
    //function to return the current user IP from api ipify using httpRequest
    function getUserIP() {
      var httpRequest = new XMLHttpRequest();
      httpRequest.open('GET', 'https://api.ipify.org?format=json', false);
      httpRequest.send();
      if (httpRequest.status === 200) {
        return JSON.parse(httpRequest.responseText).ip;
      }
    }


    //get IP 
    document.getElementById("test-ip").addEventListener("click", testIP);
    function testIP() {
      document.getElementById("ip-container").value = getUserIP();

    }






    //get id from IP
    document.getElementById("test-id").addEventListener("click", testID);

    function testID() {
      let ip = document.getElementById("ip-container").value;
      document.getElementById("test-id-container").innerHTML = "El user id es: " + getOldUserUID(ip);

    }

    //function to get the old user UID from the database by the IP
    function getOldUserUID(ip) {
      ip = ip.replace(/\./g, "");

      let url = `${firebaseConfig.databaseURL}/ips/${ip}/user_id/.json`;
      console.log(httpRequest(url).replace(/"/g, ''));
      return httpRequest(url).replace(/"/g, '');
      //the above code removes the double quotes from the response

    }





    //function to make an http request to the URL and return the response
    function httpRequest(url) {
      var httpRequest = new XMLHttpRequest();
      httpRequest.open('GET', url, false);
      httpRequest.send();
      if (httpRequest.status === 200) {
        return httpRequest.responseText;
      } else {
        return null;
      }
    }

    //function to check if the data exists in the database
    function dataExists(url) {
      let data = httpRequest(url);
      if (data != "null") {
        return true;
      } else {
        return false;
      }
    }



  </script>

</body>

</html>